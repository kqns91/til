# アクセス制御

## 種類

- ACL
  - 特定のリソースに対するアクセス許可を明示的にリスト化したもの。
  - 各リソースに対して、誰がどのような操作を行うことができるかを定義する。
- RBAC
  - ユーザーに直接権限を付与するのではなく、ユーザーにロールを割り当て、ロールに対してアクセス権限を設定する。
- ABAC
  - ユーザーやリソースに付随する属性に基づいてアクセス制御を行う。
  - 「役職がマネージャーで、かつ平日9時~18時に限りアクセスを許可する」などの細かい条件設定が可能。

## Casbin

ACL, RBAC, ABACのようなアクセス制御モデルをサポートする認証ライブラリ。

### PERM メタモデル

|セクション|説明|
|-|-|
|request_definition|リクエストのパラメータ定義|
|policy_definition|ポリシールールのフィールド定義|
|matchers|request と policy のマッチングルール|
|policy_effect|matchers のマッチング結果に対する論理的な組み合わせ判断の定義|

モデルは動的なコンポーネントではなく、ランタイムで変更すべきではないため、ロードしかできない。
ロード先には、.conf ファイル、コード、、文字列などが指定できる。

### ポリシー

アクセス制御を管理するためのルールセット。

保存先には、ファイルストレージ（Minio, S3）、データベース（postgres, mysql, sqlite, oracle, mariaDB, dynamoDB, Spanner, Redis, etcd）などが指定できる。

### casbin service

アクセス制御のみをサーバーとして提供する。  
Management API と RBAC API を提供している。gRPC を使用している。  

### パフォーマンスについて

高トラフィックやポリシールールが多い場合には、1つの casbin インスタンスだけでは全てのリクエストを処理するのに十分ではなくなることがある。  

対策

- マルチスレッドを使用して複数の casbin インスタンスを有効し、マシンの全てのコアをフル活用する。
- casbin インスタンスを複数のマシンにデプロイし、watcher を使用して全ての casbin インスタンスが一貫していることを確認する。
